---
title: "MSDS6372 Project 2 - Osteoporosis in Women"
author: "Caroll Rodriguez, Rajat Chandna, Randall Hendrickson, Lokesh Maganti"
date: "August 18, 2018"
output: 
  html_document:
    toc: yes
    keep_md: yes
  pdf_document:
    toc: yes
---
<style type="text/css">

body, td {
   font-size: 16px;
}
code.r{
  font-size: 8px;
}
pre {
  font-size: 10px
}
/* code.r will control the font size for R code echoed from the code chunk, while pre will apply to any R results output from the code. */
</style>

```{r setup00, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(knitr)
library(kableExtra)

```
\newpage

## **Objective 1** - EDA and logistic regression model

Display the ability to perform EDA and build a logistic regression model

•	Perform your logistic regression analysis and provide interpretation of the regression coefficients including hypothesis testing, and confidence intervals. For simplicity sake, you do not need to include interactions with this model. Comment on the  practical vs statistical significance of the deemed important factors..

Logistical Considerations.

•	Just like last time, this does not have to be extremely fancy in terms of the model building approach, let EDA, feature selection, and overall intuition guide you.

## Introduction

## Data Description
<p>The data set provided is about predicting whether a woman with osteoporosis will have another bone fracture.  Of course getting a bone fracture is somewhat circumstantial, but with this disease every day life could trigger a break if the progression of the disease is strong.  

The dataset included a total of 14 variables: 3 ID variables which tell us the subject, doctor and physical location of each record, 4 continuous variables (BMI, Weight, Height, and Age), 6 categorical variables (PRIORFRAC, PREMENO, MOMFRAC, PREMEO, MOMFRAC, ARMASSIST, SMOKE, RATERISK), and the response (FRACTURE). We were unable to find a mapping the subjects with their location to understand the mix of countries represented.

We have 500 subjects in the dataset of which 33% of the subjects have/had fractures. 

Missing values were not detected in dataset. Special characters were removed from column headings.
What we know/don't know about the sample (500)


## Exploratory Analysis  

### Assumptions  
This is a prospective study which means it's a study over time of a group of similar individuals
who differ with respect to certain factors under a study and how these factors affect rates of a certain outcome
(Fracture vs No-Fracture) Linearity - Independence of errors - Based on SUB_ID(Subject ID) we confirm
each record is an independent sample. Multicollinearity - Weight and BMI are highly correlated but we will
remove one from the analysis.


```
GLOW dataset:

Variable Name Type   #Unique  

     SUB_ID  integer  500 - Identification Code (1 - n)  
    SITE_ID  integer    6 - Study Site (1 - 6)  
     PHY_ID  integer  127 - Physician ID code (128 unique codes)  
 PRIORFRAC*   factor    2 - History of Prior Fracture (1: No, 2: Yes)   
        AGE  integer   36 - Age at Enrollment (Years)  
     WEIGHT  numeric  128 - Weight at enrollment (Kilograms)  
     HEIGHT  integer   34 - Height at enrollment (Centimeters)  
        BMI  numeric  409 - Body Mass Index (Kg/m^2)  
   PREMENO*   factor    2 - Menopause before age 45 (1: No, 2: Yes)  
   MOMFRAC*   factor    2 - Mother had hip fracture (1: No, 2: Yes)  
 ARMASSIST*   factor    2 - Arms are needed to stand from a chair (1: No, 2: Yes)  
     SMOKE*   factor    2 - Former or current smoker (1: No, 2: Yes)  
  RATERISK*   factor    3 - Self-reported risk of fracture (1: Less, 2: Same, 3: Greater)    
  FRACSCORE  integer   12 - Fracture Risk Score (Composite Risk Score)  
  FRACTURE*   factor    2 - Any fracture in first year (1: No, 2: Yes)  
  
```
```{r, echo = FALSE, out.width="25%"}
myimages<-list.files("./eda_images/continuous", pattern = ".png", full.names = TRUE)
include_graphics(myimages)
```

#### Figure 1 - Boxplots for Continuous Variables AGE, BMI, HEIGHT, WEIGHT

In Figure 1, we see the boxplots for the continous variables AGE, WEIGHT, HEIGHT, BMI.  

```{r, echo = FALSE, out.width="25%"}
myimages<-list.files("./eda_images/continuous_visual", pattern = ".png", full.names = TRUE)
include_graphics(myimages)
```

#### Figure 2 - Correlation, and Density plots for Continuous Variables AGE, BMI, HEIGHT, WEIGHT

```{r, echo = FALSE, out.width="50%"}
myimages<-list.files("./eda_images/multivariate", pattern = ".png", full.names = TRUE)
include_graphics(myimages)
```

#### Figure 3 - Barplot (occurrances) and Multivariate Plots for Categorical and Continuous Variables 


```{r, echo = FALSE, out.width="50%"}
myimages<-list.files("./eda_images/scatterplots", pattern = ".png", full.names = TRUE)
include_graphics(myimages)
```

#### Figure 4 - Scatterplots 

```{r, echo = FALSE, out.width="25%"}
myimages<-list.files("./eda_images/roc_and_2way", pattern = ".png", full.names = TRUE)
include_graphics(myimages)
```

#### Figure 5 - ROC and 2-way Tables 

```{r, echo = FALSE, out.width="50%"}
myimages<-list.files("./eda_images/clustering", pattern = ".png", full.names = TRUE)
include_graphics(myimages)
```

#### Figure 6 - Clustering  



## Restatement of Problem and the overall approach to solve it.

## Model Selection

## Checking Assumptions

## Parameter Interpretation

## Final conclusions from the analysis of Objective 1



```
to do:


take writeup from EDA and place here with reference to figures, etc

```




\newpage

## **Objective 2** - additional competing models

•	Record the predictive performance metrics from your simple, highly interpretable model from Objective 1.  


•	You must include one additional model which is also a more complicated logistic regression model than in Objective 1.  By complicated, I do not mean that you include more predictors (that will be somewhat sorted out in Objective 1), but rather model complexity through interaction terms, new variables created by the group, or transformations.

•	Create another competing model using just the continuous predictors and use LDA or QDA.

•	Use a nonparameteric model approach as a competing model.  Random forest for predictors that are both categorical and continuous or a k-nearest neighbors approach if just working with continuous predictors. 

•	Provide a summary table of the performance across the competing methods. Summarize the overall findings.  A really great report will also give insight as to why the “best” model won out.  This is where a thorough EDA will always help.

## Record predictive performance from objective 1

## Another competing model (interaction terms)

## Another competing model (just continuous) LDA

## nonparametric model (random forest)

## another nonparametric model (conditional random forest)

## Summary table of performance

| Model                                                         | Predictors         | Accuracy | 95% CI         | Sensitivity | Specificity | AUC   |
|---------------------------------------------------------------|--------------------|----------|----------------|-------------|-------------|-------|
| Logistic Regression (logit)                                   | 7                  | 74.5%    | (66.7%, 81.3%) | 94.6%       | 13.5%       | 67.8% |
| Logistic Regression w/Interactions (logit)                    | 7 + 3 interactions | 75.2%    | (67.4%, 81.9%) | 92.9%       | 21.6%       | 72.2% |
| Random Forest*                                                | 10                 | 74.5%    | (66.7%, 81.3%) | 99.1%       | 0.0%        | 74.2% |
| *RF Lower Cutoff (decreasing the probability from 50% to 30%) | 10                 | 73.8%    | (66%, 80.7%)   | 91.1%       | 21.6%       |       |
| Conditional Random Forest                                     | 10                 | 75.2%    | (67.4%, 81.9%) | 94.6%       | 16.2%       | 69.3% |
| LDA                                                           | 4                  | 73.2%    | (65.3%, 80.1%) | 94.6%       | 8.1%        | 60.2% |


## Conclusion/Discussion


```
to do:


take writeup from EDA and place here with reference to figures, etc

```



## ***Appendix*** ==========================================  


## *** ***Appendix A:*** EDA - Analysis =======================  


```{r child = 'EDA.Rmd'}
```


## *** ***Appendix B:*** Model Comparison - Analysis ==========  


```{r child = 'ModelComparison.Rmd'}
```


## *** ***Appendix C:*** Test interaction - LDA ===============  


```{r child = 'test_interaction.Rmd'}
```

